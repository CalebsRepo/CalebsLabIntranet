<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css">
    <!--DatePicker--><link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="../css/project_plan.css">
    <script src="../js/common.js"></script>
    <script src="../js/login.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <!--DatePicker--><script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <!--DatePicker--><script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!--DatePicker--><script src="../js/datepicker.js"></script>

    <title></title>
    <!--로그인 세션 공통-->
    <script>
    var loginUser = JSON.parse(getUserData());
    var loginUserAdmFlag = loginUser.adm_flag;
    $(document).ready(function(){
         if(loginUserAdmFlag == "A" || loginUserAdmFlag == "G"){
            $(".admMenu").show();
        }
    });
    </script>

    <script>
      var trigger = "";
      var paramJSON = new Object();
        $(document).ready(function(){
            getProject();
            $('.datepicker').datepicker();
            //일정명 글자수 제한
            $("#select-1").on('keyup',function(){
                if($(this).val().length > 25){
                    $(this).val($(this).val().substring(0,25));
                }
            });
           $("#textarea-6").on('keyup',function(){
                if($(this).val().length > 200){
                    $(this).val($(this).val().substring(0,200));
                }
            });
        });

      function getProject() {
            trigger = "during";
            paramJSON.trigger = trigger;
            navigate(paramJSON, "getAllProjectList.json", projectSelectSuccess, "" );
       }
      function projectSelectSuccess(result) {
            console.log("성공");
            var projectSelectResult="";
            var parseProjectResult="";
            console.log("============================================");
            projectSelectResult=JSON.stringify(result);
            parseProjectResult=JSON.parse(projectSelectResult);
            console.log("projectSelectSuccess>>>>>" + projectSelectResult);
            console.log("============================================");

            if (parseProjectResult.length != 0) {
                for(var i=0; i<parseProjectResult.length; i++) {
                    $("#select-1").append(
                           "<option value='"+parseProjectResult[i].project_code + "'>" + parseProjectResult[i].project_name + "</option>"
                      );
                    $("#select-1").selectmenu("refresh", true);
                    }
                } else {
                $("#select-1").append(
                           "<option value=''>현재 진행중인 프로젝트가 없습니다.</option>"
                   );
            }
      }
      function doPlanRegister(){

            //값 가져오기
            var projectCode = document.getElementById('select-1');
            var kindSelect  = document.getElementById('select-3');

            var id             = loginUser.id;
            var project_code   = projectCode.options[projectCode.selectedIndex].value;
            var schedule_name  = $("#textinput-2").val();
            var kind_code      = kindSelect.options[kindSelect.selectedIndex].value;
            var start_dt       = ($("#textinput-4").val()).replace(/[^0-9]/g,'');  // 숫자만 남기고 모두 제거
            var end_dt         = ($("#textinput-5").val()).replace(/[^0-9]/g,'');  // 숫자만 남기고 모두 제거
            var contents       = $("#textarea-6").val();

            //valueCheck 값 체크 함수 호출
            //schedule_name 글씨 길이? 특수문자 안됨
            //start_dt 일정이 프로젝트 시작일보다

            // paramJSON.에 태우기
            paramJSON.id              = id;
            paramJSON.project_code    = project_code;
            paramJSON.schedule_name   = schedule_name;
            paramJSON.kind_code       = kind_code;
            paramJSON.start_dt        = start_dt
            paramJSON.end_dt          = end_dt;
            paramJSON.contents        = contents;

            //중복 추가되지 않게 함수

            navigate(paramJSON, "planRegister.json", planRegisterSuccess, "" );

        }
        function planRegisterSuccess(result){
            //ok면 alert 정상적으로 등록되었습니다. + 목록으로(목록) or 다른 일정 등록(현재 페이지 네비게이트)
            //아니면 일정이 정상적으로 등록되지 않았습니다. 다시 시도해주세요. (현재 페이지 네비게이트)
            alert("성공");
            if(confirm(‘진짜?’)) {
            document.write(“네”)
            } else {
            document.write(“아니오”)
            }

        }
        function valueCheck(){

        }

    </script>
</head>

<body>
<section id="page1" data-role="page" class="container">

    <header data-role="header">
        <h1>프로젝트 일정</h1>
        <a class="ui-btn ui-corner-all ui-btn-inline ui-mini footer-button-left ui-btn-icon-left ui-icon-carat-l" href="javascript:history.back()">back</a>
        <a href="#menuPanel" class="ui-btn-right" data-icon="bars">menu</a>
    </header>

    <div data-role="content" class="plan-detail">
        <!--제목-->
        <div  class="title-area">
            <div class="gird-pt">
                <h3>• 프로젝트 일정 등록 </h3>
            </div>
        </div>
        <style>
            div#select-2-button { padding: 7.5px 5px; background:#ffffff;}
            div#select-2-button span { text-align: left; font-weight: 600;}

        </style>

        <!--프로젝트 리스트화면-->
        <div class="gird-pt detail-form">
            <form>
                <div class="ui-field-contain">
                    <label for="select-1">프로젝트명:</label>
                    <select name="select-1" id="select-1" class="ui-corner-all">
                        <!--진행중 프로젝트 리스트-->
                    </select>
                </div>
                <div class="ui-field-contain">
                    <label for="textinput-project-term">프로젝트 기간:</label>
                    <input type="text" name="textinput-project-term" id="textinput-project-term" placeholder="" value="2018/11/16 ~ 2018/12/30" readonly>
                </div>
               <div class="ui-field-contain">
                   <label for="textinput-2">일정명:</label>
                   <input type="text" name="textinput-2" id="textinput-2" placeholder="25자 이내로 입력해주세요." value="">
               </div>
                <div class="ui-field-contain">
                    <label for="select-3">구분:</label>
                    <select name="select-3" id="select-3" class="ui-corner-all">
                        <option value="업무">업무</option>
                        <option value="휴가">휴가</option>
                        <option value="회사">회사</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="ui-field-contain">
                    <label for="textinput-4">시작일:</label>
                        <div id="textinput-4 datepicker" class="picker">
                            <input type="text" name="textinput-4" id="textinput-4" class="datepicker" placeholder="시작일을 선택해주세요" value="" readonly>
                        </div>
                </div>
                <div class="ui-field-contain">
                    <label for="textinput-5">종료일:</label>
                        <div id="textinput-5 datepicker" class="picker">
                            <input type="text" name="textinput-5" id="textinput-5" class="datepicker" placeholder="종료일을 선택해주세요" value="" readonly>
                        </div>
                </div>
                <div class="ui-field-contain">
                    <label for="textarea-6">설명:</label>
                    <textarea type="textarea" name="textarea-6" id="textarea-6" placeholder="요구사항 및 내용을 입력해주세요(200자 이내)" value="" ></textarea>
                </div>

            </form>
        </div>
        <style>

        </style>
        <div class="btn-area-1">
            <div class="grid-pt">
                <div class="grid-cd-1"><a href="#" class="ui-btn ui-shadow ui-corner-all">취소</a></div>
                <div class="grid-cd-2"><a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-b" onclick="doPlanRegister()">등록</a></div>
            </div>
        </div>
        <div class="btn-area-2">
            <div class="gird-pt">
                <button class="ui-btn ui-corner-all ui-btn-b" onclick="common_movePage('index.html')" >목록</button>
            </div>
        </div>
        <div class="btn-area-3">
            <div class="grid-pt">
                <div class="grid-cd-1"><a href="#" class="ui-btn ui-shadow ui-corner-all">취소</a></div>
                <div class="grid-cd-2"><a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-b" onclick="movePage('index.html')">삭제</a></div>
                <div class="grid-cd-3"><a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-b" onclick="movePage('index.html')">등록</a></div>
            </div>
        </div>
    </div>

    <!-- footer -->
    <div class="footer" data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a onclick="movePage('main.html')" data-icon="home">홈</a></li>
                <li><a onclick="movePage('projectList.html')" data-icon="shop">프로젝트</a></li>
                <li><a href="#" data-icon="calendar">휴가신청</a></li>
                <li><a href="#" data-icon="power" onclick="javascript:callLogout()";>로그아웃</a></li>
            </ul>
        </div>
    </div>
</section>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">

    <link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css">
    <link rel="stylesheet" href="../css/project_plan.css">
    <script src="../js/common.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <script type="text/javascript">
        var trigger = "";
        var start_num = 0;
        var paramJSON = new Object();
        var today = todayFormat();

        $(document).ready(function(){
            <!--최초로 진행중인 프로젝트 목록을 가져온다-->
            $("#listArea").empty();
            getProject();
        });

        //오늘날짜 포맷 리턴
        function todayFormat(){
            var now = new Date();
            var todayUTC = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));
            return todayUTC.toISOString().slice(0, 10).replace(/-/g, '');
        }

        function YMDFormatter(num){
             if(!num) return "";
             var formatNum = '';

             // 공백제거
             num=num.replace(/\s/gi, "");

             try{
                  if(num.length == 8) {
                       formatNum = num.replace(/(\d{4})(\d{2})(\d{2})/, '$1/$2/$3');
                  }
             } catch(e) {
                  formatNum = num;
                  console.log(e);
             }
             return formatNum;
        }

        function flipChange() {
            start_num = 0; // 시작번호 0으로 초기화
            $("#listArea").empty();
            getProject();
        }

        function getProject() {
            var flip = document.getElementById('flip');
            if(flip.checked == true) {
                trigger = "during";
            } else {
                trigger = "all";
            }

            paramJSON.start_num = start_num;
            paramJSON.trigger = trigger;

            navigate(paramJSON, "getProject.json", projectSelectSuccess, projectSelectError);
        }

        function projectSelectSuccess(result) {
            console.log("성공");
            var projectSelectResult="";
            var parseProjectResult="";
            console.log("============================================");
            projectSelectResult=JSON.stringify(result);
            parseProjectResult=JSON.parse(projectSelectResult);
            console.log("projectSelectSuccess>>>>>" + projectSelectResult);
            console.log("============================================");

            var iHTML = "";
            //데이터가 없을 시
            if(parseProjectResult.length < 1) {
                iHTML += "<div class='ui-corner-all' style='text-align: center;'>";
                iHTML += "<span color='red'>조회내역이 없습니다.</span>";
                iHTML += "</div>";
            }

            for(var i=0; i<parseProjectResult.length; i++) {
                var member_cnt = parseProjectResult[i].member_cnt;
                console.log("member_cnt = " + member_cnt);
                var end_ymd = parseProjectResult[i].end_ymd;
                console.log("end_ymd = " + end_ymd);
                var start_ymd = parseProjectResult[i].start_ymd;
                console.log("start_ymd = " + start_ymd);
                var project_code = parseProjectResult[i].project_code;
                console.log("project_code = " + project_code);
                var project_name = parseProjectResult[i].project_name;
                console.log("project_name = " + project_name);
                var project_sts = "";
                // 프로젝트 상태를 현재날짜와 시작,종료일을 이용하여 구한다.
                if(end_ymd > today || end_ymd == today) { // 종료일이 현재날짜이거나 이후인 경우
                    if(start_ymd > today) { // 시작일이 현재날짜 이후인 경우
                        project_sts = "프로젝트 시작전";
                    } else { // 시작일이 현재날짜이거나 이전인 경우
                        project_sts = "프로젝트 진행중";
                    }
                } else { // 종료일이 현재날짜보다 이전인 경우
                    project_sts = "프로젝트 종료";
                }
                console.log("project_sts = " + project_sts);
                iHTML += '<li class="ui-corner-all">'
                iHTML += '	<a href="#" class="list-detail ui-btn ui-btn-icon-right ui-icon-carat-r" onclick="movePage(\'projectDetail.html\', \''+project_code+'\')">'
                iHTML += '	    <div class="plan plan-name">프로젝트명 : '+project_name+'</div>'
                iHTML += '	    <div class="plan plan-date">기간 : '+YMDFormatter(start_ymd)+' ~ '+YMDFormatter(end_ymd)+'</div>'
                iHTML += '	    <div class="plan plan-people">참여인원 : '+member_cnt+'명</div>'
                iHTML += '	    <div class="plan plan-state">상태 : '+project_sts+'</div>'
                iHTML += '	</a>'
                iHTML += '</li>'
            }

            $("#listArea").append(iHTML);
            start_num = start_num + 10;

            if(parseProjectResult.length < 10){
                $('#btnMore').hide();
            } else {
                $('#btnMore').show();
            }
        }

        function projectSelectError(result) {
            console.log("실패");
        }

    </script>
</head>

<body>
<section id="page1" data-role="page">
    <!-- header -->
    <header data-role="header">
        <h1>프로젝트 목록</h1>
        <a class="ui-btn ui-corner-all ui-btn-inline ui-mini footer-button-left ui-btn-icon-left ui-icon-carat-l" href="javascript:history.back()">back</a>
        <a href="#menuPanel" data-icon="bars">menu</a>
    </header>
    <div data-role="panel" id="menuPanel" data-position="right" data-display="overlay" data-theme="a">
        <h2>메뉴</h2>
        <ul data-role="listview">
            <p>내정보</p>
            <li><a href="#">마이페이지</a></li>
            <p>프로젝트</p>
            <li><a href="#">프로젝트</a></li>
            <li><a href="#">프로젝트일정 목록</a></li>
            <p>휴가</p>
            <li><a href="#">휴가신청</a></li>
            <li><a href="#">휴가신청내역</a></li>
            <li><a href="#">휴가캘린더</a></li>
            <p>게시판</p>
            <li><a href="#">FAQ</a></li>
            <p>관리</p>
            <li><a href="#">사원등록</a></li>
            <li><a href="#">사원목록</a></li>
            <li><a  onclick="movePage('main.html')">휴가현황</a></li>
        </ul>
    </div>
    <!--container-->
    <div data-role="content" class="project-list">
        <!--제목, flip(진행중, 전체)추가버튼-->
        <div  class="title-area">
            <div class="gird-pt">
                <div class="grid-cd-1">
                    <h3>• 프로젝트 일정 </h3>
                </div>

                <div class="grid-cd-2">
                    <input type="checkbox" data-role="flipswitch" name="flip" id="flip" data-on-text="진행중" data-off-text="전체" onchange="flipChange()" data-wrapper-class="custom-label-flipswitch" checked>
                    <style>
                        .custom-label-flipswitch.ui-flipswitch .ui-btn.ui-flipswitch-on {
                            text-indent: -3.4em;
                        }
                        .custom-label-flipswitch.ui-flipswitch .ui-flipswitch-off {
                            text-indent: 0.5em;
                        }
                    </style>
                </div>
                <div class="grid-cd-3">
                    <a href="#" class="ui-shadow ui-btn ui-corner-all ui-btn-inline ui-btn-b">추가</a>
                </div>
            </div>
        </div>

        <!--최초 페이지 로드-->
        <!--진행중으로 select(startNum = 1, endNum = 10)-->
        <!--LIst 출력-->
        <!--flip Event(value값에 따라 - pageNum은 다시 초기화)-->
        <!--진행중 select-->
        <!--fulldata select-->

        <!--프로젝트 리스트화면-->
        <div class="gird-pt summary-list">
            <ul data-role="listview" id="listArea" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow"data-theme="b">
                <li class="ui-corner-all">
                    <a href="planList.html" class="list-detail ui-btn ui-btn-icon-right ui-icon-carat-r">
                        <div class="plan plan-name">프로젝트명 : NH 통합스마트뱅킹</div>
                        <div class="plan plan-date">기간 : 2018/04/23 ~ 2018/12/31</div>
                        <div class="plan plan-people">참여인원 : 4명</div>
                        <div class="plan plan-state">상태 : 프로젝트 종료</div>
                    </a>
                </li>
                <li class="ui-corner-all">
                    <a href="#" class="list-detail ui-btn ui-btn-icon-right ui-icon-carat-r">
                        <div class="plan plan-name">프로젝트명 : 하나로브랜치 고도화</div>
                        <div class="plan plan-date">기간 : 2018/11/20 ~ 2019/01/07</div>
                        <div class="plan plan-people">참여인원 : 8명</div>
                        <div class="plan plan-state">상태 : 프로젝트 종료</div>
                    </a>
                </li>
            </ul>
        </div>

        <div class="gird-pt">
         <button class="ui-btn ui-corner-all ui-btn-b" id="btnMore" onclick="getProject()">더보기</button>
        </div>
    </div>
    <!--//container-->
    <!-- footer -->
    <div style="overflow: hidden;" data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#" data-icon="home">홈</a></li>
                <li><a href="#" data-icon="shop">프로젝트</a></li>
                <li><a href="#" data-icon="calendar">휴가신청</a></li>
                <li><a href="#" data-icon="power">로그아웃</a></li>
            </ul>
        </div>
    </div>
</section>
</body>
</html>

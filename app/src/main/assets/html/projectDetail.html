<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css">
    <link rel="stylesheet" href="../css/menu.css">
    <link rel="stylesheet" href="../css/project_info.css">
    <script src="../js/common.js"></script>
    <script src="../js/login.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.1.min.js"></script>
    <script src="../js/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!--DatePicker--><script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <!--DatePicker--><script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../js/datepicker.js"></script>
    <script type="text/javascript">
        // 전역변수 선언
        var parseCompanyResult=""; // 발주회사 정보
        var parseEmployeeResult=""; // 사원목록 정보
        var projectSelectInfoJSON = ""; // 프로젝트 조회 정보
        var selectMemberProjectInfo = ""; // 프로젝트 참여 멤버정보
        var sessionID = ""; // 로그인ID
        var isEditor = ""; // 관리자여부
        var projectCode = ""; // 프로젝트 코드
        var ind=0; // 동적으로 생성될 listview의 index정보

        $(document).ready(function(){
            // 세션에서 로그인 유저 정보를 가져옴
            var sessionData = JSON.parse(getUserData());
            sessionID = sessionData.id;
            var sessionAdmFlag = sessionData.adm_flag; // 관리자 => A, G
            console.log("sessionAdmFlag = " + sessionAdmFlag);
            if(sessionAdmFlag == 'A' || sessionAdmFlag == 'G') {
                isEditor = true;
                $(".admMenu").show();
            } else {
                isEditor = false;
            }

            // db에서 값을 가져와 화면에 출력해줘야 하는 데이터를 받아온다
            navigate("", "getPrintInfo.json", getPrintInfoSuccess);
        });

        <!--화면에 출력해줘야 하는 데이터 select 성공-->
        function getPrintInfoSuccess(result) {
            printInfoResult="";
            //console.log("============================================");
            var printInfoResult=JSON.stringify(result);
            var parsePrintResult=JSON.parse(printInfoResult);
            //console.log("getPrintInfoSuccess>>>>>" + parsePrintResult);
            //console.log("============================================");

            parseCompanyResult = parsePrintResult.company;
            parseEmployeeResult = parsePrintResult.employee;

            <!--ID로 select태그를 찾아 변수에 Mapping-->
            var selbox = document.getElementById('projectComp');

            for(var i=0; i<parseCompanyResult.length; i++) {
                //console.log(parseCompanyResult[i].comp_id);
                //console.log(parseCompanyResult[i].comp_name);

                <!--발주회사 id와 이름을 가져와 option에 value, text와 Mapping-->
                var op = new Option();

                op.value = parseCompanyResult[i].comp_id;
                op.text = parseCompanyResult[i].comp_name;

                <!--selectBox에 option 추가-->
                selbox.options.add(op);
            }

            projectCode = getStorageItem(); // 세션스토리지에서 프로젝트코드값을 가져온다
            console.log("projectCode = "+projectCode);
            projectCode = projectCode.replace(/^"(.*)"$/, '$1'); // 프로젝트코드값에 ""제거
            console.log("projectCode = "+projectCode);
            var  selectParam = {
                projectCode : projectCode
            };
            navigate(selectParam, "getProjectInfo.json", projectSelectSuccess, dbSelectError);
        }

        <!--프로젝트 정보 select-->
        function projectSelectSuccess(result) {
            var selectResult="";
            var parseSelectResult="";

            console.log("성공");
            console.log("============================================");
            selectResult=JSON.stringify(result);
            parseSelectResult=JSON.parse(selectResult);
            console.log("projectRegistSuccess>>>>>" + selectResult);
            console.log("============================================");

            projectSelectInfoJSON = parseSelectResult.project; // 프로젝트 정보

            // 세션ID와 등록자가 같은 경우 Editor 값 true
            if(projectSelectInfoJSON[0].register_id == sessionID) {
                isEditor = true;
            }

            // 프로젝트 정보 화면에 Set
            document.getElementById('projectName').value = projectSelectInfoJSON[0].project_name; // 프로젝트 이름
            $("#projectComp").val(projectSelectInfoJSON[0].com_code).prop("selected", true); // 프로젝트 코드와 일치하는 옵션을 selected
            var selectedIndex = document.getElementById('projectComp').selectedIndex; // select 태그에 text를 뿌려주기 위하여 선택된 option의 index값을 구한다.
            $("#projectComp-button > span").text(document.getElementById('projectComp').options[selectedIndex].text); // 위에서 구한 index의 text로 select 박스에 출력
            document.getElementById('projectStartDt').value = YMDFormatter(projectSelectInfoJSON[0].start_ymd); // 시작일
            document.getElementById('projectEndDt').value = YMDFormatter(projectSelectInfoJSON[0].end_ymd); // 종료일
            document.getElementById('projectExplain').value = projectSelectInfoJSON[0].project_detail; // 상세정보

            // 멤버정보 selectMemberProjectInfo에 저장
            selectMemberProjectInfo  = parseSelectResult.member; // 멤버정보가 배열형태로 담겨있음
            var iHTML = "";

            // listview 먼저 화면에 append
            for(var i=0; i<selectMemberProjectInfo.length; i++) {
                ind++;
                iHTML += '<div id="memberArea'+ind+'" class="member-area ui-field-contain">';
                if(isEditor) { // 수정가능권한여부(관리자, 등록자)
                    iHTML += '    <label style="width:22px"><div class="ui-checkbox"><input type="checkbox" id="listChb'+ind+'" name="listChb" style="position: unset; left: unset;"></div></label>';
                }
                iHTML += '    <ul data-role="listview" data-inset="true" class="list-area  ui-listview ui-listview-inset ui-corner-all ui-shadow">';
                iHTML += '        <li class="member-name ui-field-contain ui-li-static ui-body-inherit ui-first-child">';
                iHTML += '            <label>참여자명</label>';
                iHTML += '            <div class="member">';
                iHTML += '                <div class="ui-select"><div id="memberSel'+ind+'-button" class="ui-btn ui-icon-carat-d ui-btn-icon-right ui-corner-all ui-shadow"><span class="memberSel">선택하세요</span><select id="memberSel'+ind+'" name="memberSel" class="memberSel" onchange="memberSelect('+ind+')" style="z-index: 0;">';
                iHTML += '                    <option value="">선택하세요</option>';
                iHTML += '                </select></div></div>&nbsp;';
                iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="memberName'+ind+'" name="memberName" readonly></div>';
                iHTML += '            </div>';
                iHTML += '        </li>';
                iHTML += '        <li class="memeber-date ui-field-contain ui-li-static ui-body-inherit">';
                iHTML += '            <label>참여기간</label>';
                iHTML += '            <div class="picker">';
                iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="putDt'+ind+'" name="putDt" class="datepicker" value="'+YMDFormatter(selectMemberProjectInfo[i].mem_start_ymd)+'" readonly></div> ~';
                iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="withdrawDt'+ind+'" name="withdrawDt" class="datepicker" value="'+YMDFormatter(selectMemberProjectInfo[i].mem_end_ymd)+'" readonly></div>';
                iHTML += '            </div>';
                iHTML += '        </li>';
                iHTML += '        <li class="skill ui-field-contain ui-li-static ui-body-inherit">';
                iHTML += '            <label>사용기술</label>';
                iHTML += '            <textarea cols="40" rows="8" id="skillTarea'+ind+'" name="skill" class="ui-input-text ui-shadow-inset ui-body-inherit ui-corner-all ui-textinput-autogrow" style="height: 52px;"></textarea>';
                iHTML += '        </li>';
                iHTML += '        <li class="grade ui-field-contain ui-li-static ui-body-inherit">';
                iHTML += '            <label>기술등급</label>';
                iHTML += '            <div class="ui-select"><div id="gradeSel'+ind+'-button" class="ui-btn ui-icon-carat-d ui-btn-icon-right ui-corner-all ui-shadow"><span>선택하세요</span><select id="gradeSel'+ind+'" name="gradeSel" onchange="gradeSelect('+ind+')" style="z-index: 0;">';
                iHTML += '                <option value="">선택하세요</option>';
                iHTML += '                <option value="특급">특급</option>';
                iHTML += '                <option value="고급">고급</option>';
                iHTML += '                <option value="중급">중급</option>';
                iHTML += '                <option value="초급">초급</option>';
                iHTML += '            </select></div></div>';
                iHTML += '        </li>';
                iHTML += '        <li class="roll ui-field-contain ui-li-static ui-body-inherit ui-last-child">';
                iHTML += '            <label>참여형태</label>';
                iHTML += '            <div class="rollDiv">';
                iHTML += '                <div class="ui-select"><div id="rollSel'+ind+'-button" class="ui-btn ui-icon-carat-d ui-btn-icon-right ui-corner-all ui-shadow"><span>선택하세요</span><select id="rollSel'+ind+'" name="rollSel" onchange="rollSelect('+ind+')" style="z-index: 0;">';
                iHTML += '                    <option value="">선택하세요</option>';
                iHTML += '                    <option value="PM">PM</option>';
                iHTML += '                    <option value="PL">PL</option>';
                iHTML += '                    <option value="참여자">참여자</option>';
                iHTML += '                    <option value="직접입력">직접입력</option>';
                iHTML += '                </select></div></div>';
                iHTML += '                &nbsp;';
                iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="rollTxt'+ind+'" name="memberRoll" readonly></div>';
                iHTML += '            </div>';
                iHTML += '        </li>';
                iHTML += '    </ul>';
                iHTML += '</div>';
            }

            $("#listviewArea").append(iHTML);

            // 멤버정보 set
            for(var j = 1; j < selectMemberProjectInfo.length + 1; j++){
                // id값에 index 추가
                var nameSelID = "memberSel" + j;
                var nameInputID = "memberName" + j;
                var skillID = "skillTarea" + j;
                var gradeID = "gradeSel" + j;
                var rollSelID = "rollSel" + j;
                var rollInputID = "rollTxt" + j;

                // id로 select태그를 찾아 변수에 Mapping
                var selbox = document.getElementById(nameSelID);

                // 옵션에 사원정보 추가
                for(var nameIndex=0; nameIndex<parseEmployeeResult.length; nameIndex++) {
                    <!--멤버 id와 이름을 가져와 option에 value, text와 Mapping-->
                    var op = new Option();

                    op.value = parseEmployeeResult[nameIndex].ID;
                    op.text = parseEmployeeResult[nameIndex].NAME + "(" + parseEmployeeResult[nameIndex].ID + ")";

                    // selectBox에 option 추가
                    selbox.options.add(op);
                }

                // 직접입력 option 추가
                var op = new Option();
                op.value = "free";
                op.text = "직접입력";

                selbox.options.add(op);


                // 각각의 Element에 값 Mapping
                $("#memberSel"+j).val(selectMemberProjectInfo[j-1].id).prop("selected", true); // id와 일치하는 옵션을 selected(DB에 id값이 null인 경우 id값을 'write'로 받아온다.)
                selectedIndex = 0; // 초기화
                selectedIndex = document.getElementById('memberSel' + j).selectedIndex; // select 태그에 text를 뿌려주기 위하여 선택된 option의 index값을 구한다.
                $("#memberSel"+j+"-button > span").text(document.getElementById('memberSel' + j).options[selectedIndex].text); // 위에서 구한 index의 text로 select 박스에 출력
                // $("#memberSel"+j+"-button > span").text(selectMemberProjectInfo[j-1].name); // 선택된 값을 selectBox Span에 출력
                if(selectMemberProjectInfo[j-1].id != "free") { // 직접입력이 아닌경우
                    document.getElementById(nameInputID).value = selectMemberProjectInfo[j-1].name  + "(" +  selectMemberProjectInfo[j-1].id + ")"; // 이름(id)
                } else {
                    document.getElementById(nameInputID).value = selectMemberProjectInfo[j-1].name; // 이름
                }
                document.getElementById(skillID).value = selectMemberProjectInfo[j-1].skill; // 사용기술
                $("#gradeSel"+j).val(selectMemberProjectInfo[j-1].grade).prop("selected", true); // 등급과 일치하는 옵션을 selected
                $("#gradeSel"+j+"-button > span").text(selectMemberProjectInfo[j-1].grade); // 선택된 값을 selectBox Span에 출력
                $("#rollSel"+j).val(selectMemberProjectInfo[j-1].charge_job).prop("selected", true); // 참여형태와 일치하는 옵션을 selected
                $("#rollSel"+j+"-button > span").text(selectMemberProjectInfo[j-1].charge_job); // 선택된 값을 selectBox Span에 출력
                document.getElementById(rollInputID).value = selectMemberProjectInfo[j-1].charge_job; // 참여형태

                // db에 key가 되는 이름은 수정이 되지 않도록 disabled 설정한다
                $("#memberSel"+j).attr("disabled", true);
            }

            // 수정권한 보유여부 확인 및 버튼 hide
            if(isEditor) { // 수정가능
                $('#btnReadonly').hide();

                // 프로젝트 종료일이 시작일 이후로만 선택되도록 datepicker를 설정
                $("#projectStartDt").datepicker({
                    onSelect: function(selected) {
                        $("#projectEndDt").datepicker("option","minDate", selected)
                    }
                });
                $("#projectStartDt").datepicker("option","maxDate", $("#projectEndDt").val());

                $("#projectEndDt").datepicker({
                    onSelect: function(selected) {
                        $("#projectStartDt").datepicker("option","maxDate", selected)
                    }
                });
                $("#projectEndDt").datepicker("option","minDate", $("#projectStartDt").val());

                for(var j = 1; j < selectMemberProjectInfo.length + 1; j++){
                // 프로젝트 철수일이 투입일 이후로만 선택되도록 datepicker를 설정
                    $("#putDt"+j).datepicker({
                        onSelect: function(selected) {
                            $("#withdrawDt"+j).datepicker("option","minDate", selected)
                        }
                    });
                    $("#putDt"+j).datepicker("option","maxDate", $("#withdrawDt"+j).val());

                    $("#withdrawDt"+j).datepicker({
                        onSelect: function(selected) {
                            $("#putDt"+j).datepicker("option","maxDate", selected)
                        }
                    });
                    $("#withdrawDt"+j).datepicker("option","minDate", $("#putDt"+j).val());
                }
            } else {
                $('#btnMemberEdit').hide();
                $('#btnEdit').hide();
                $("input").attr("readonly", true); //input태그 전부 readonly 설정
                $("textarea").attr("readonly", true); //textarea태그 전부 readonly 설정
                $("select").attr("disabled", true); //select태그 전부 disabled 설정
            }
        }

        function dbSelectError(result) {
            console.log("실패");
        }

        <!--참여인원 삭제버튼 클릭 이벤트-->
        function btnDel() {
            console.log("btnDel 함수 진입");
            var checkbox = document.getElementsByName("listChb"); // 체크박스 Element를 배열로 Get
            var listviewArea = document.getElementById("listviewArea");
            var checkboxLength = checkbox.length;
            console.log("checkboxLength = " + checkboxLength);
            for(var i=0; i<checkbox.length; i++) {
                console.log("i = " + i);
                if(checkbox[i].checked == true) {
                    var checkboxID = checkbox[i].id; // ID 추출
                    console.log(checkboxID + " is checked");
                    var index = checkboxID.replace(/[^0-9]/g,''); // list의 index를 찾기 위해 id값에서 숫자만 추출
                    console.log("index = " + index);
                    var memberAreaID = "memberArea" + index; // listForm의 ID를 index로 Mapping
                    console.log("memberAreaID = " + memberAreaID);
                    var removeArea = document.getElementById(memberAreaID); // Mapping한 ID로 Remove할 division을 Get
                    listviewArea.removeChild(removeArea); // Division 삭제
                    i--;
                } else {
                    var checkboxID = checkbox[i].id;
                    console.log(checkboxID + "is not checked");
                }
            }
        }
        <!--참여인원 추가버튼 클릭 이벤트-->
        function btnAdd() {
            var iHTML = "";
            ind++;

            iHTML += '<div id="memberArea'+ind+'" class="member-area ui-field-contain">';
            iHTML += '    <label style="width:22px"><div class="ui-checkbox"><input type="checkbox" id="listChb'+ind+'" name="listChb" style="position: unset; left: unset;"></div></label>';
            iHTML += '    <ul data-role="listview" data-inset="true" class="list-area  ui-listview ui-listview-inset ui-corner-all ui-shadow">';
            iHTML += '        <li class="member-name ui-field-contain ui-li-static ui-body-inherit ui-first-child">';
            iHTML += '            <label>참여자명</label>';
            iHTML += '            <div class="member">';
            iHTML += '                <div class="ui-select"><div id="memberSel'+ind+'-button" class="ui-btn ui-icon-carat-d ui-btn-icon-right ui-corner-all ui-shadow"><span class="memberSel">선택하세요</span><select id="memberSel'+ind+'" name="memberSel" class="memberSel" onchange="memberSelect('+ind+')" style="z-index: 0;">';
            iHTML += '                    <option value="">선택하세요</option>';
            iHTML += '                </select></div></div>&nbsp;';
            iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="memberName'+ind+'" name="memberName" readonly></div>';
            iHTML += '            </div>';
            iHTML += '        </li>';
            iHTML += '        <li class="memeber-date ui-field-contain ui-li-static ui-body-inherit">';
            iHTML += '            <label>참여기간</label>';
            iHTML += '            <div class="picker">';
            iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="putDt'+ind+'" name="putDt" class="datepicker" readonly></div> ~';
            iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="withdrawDt'+ind+'" name="withdrawDt" class="datepicker" readonly></div>';
            iHTML += '            </div>';
            iHTML += '        </li>';
            iHTML += '        <li class="skill ui-field-contain ui-li-static ui-body-inherit">';
            iHTML += '            <label>사용기술</label>';
            iHTML += '            <textarea cols="40" rows="8" id="skillTarea'+ind+'" name="skill" class="ui-input-text ui-shadow-inset ui-body-inherit ui-corner-all ui-textinput-autogrow" style="height: 52px;"></textarea>';
            iHTML += '        </li>';
            iHTML += '        <li class="grade ui-field-contain ui-li-static ui-body-inherit">';
            iHTML += '            <label>기술등급</label>';
            iHTML += '            <div class="ui-select"><div id="gradeSel'+ind+'-button" class="ui-btn ui-icon-carat-d ui-btn-icon-right ui-corner-all ui-shadow"><span>선택하세요</span><select id="gradeSel'+ind+'" name="gradeSel" onchange="gradeSelect('+ind+')" style="z-index: 0;">';
            iHTML += '                <option value="">선택하세요</option>';
            iHTML += '                <option value="특급">특급</option>';
            iHTML += '                <option value="고급">고급</option>';
            iHTML += '                <option value="중급">중급</option>';
            iHTML += '                <option value="초급">초급</option>';
            iHTML += '            </select></div></div>';
            iHTML += '        </li>';
            iHTML += '        <li class="roll ui-field-contain ui-li-static ui-body-inherit ui-last-child">';
            iHTML += '            <label>참여형태</label>';
            iHTML += '            <div class="rollDiv">';
            iHTML += '                <div class="ui-select"><div id="rollSel'+ind+'-button" class="ui-btn ui-icon-carat-d ui-btn-icon-right ui-corner-all ui-shadow"><span>선택하세요</span><select id="rollSel'+ind+'" name="rollSel" onchange="rollSelect('+ind+')" style="z-index: 0;">';
            iHTML += '                    <option value="">선택하세요</option>';
            iHTML += '                    <option value="PM">PM</option>';
            iHTML += '                    <option value="PL">PL</option>';
            iHTML += '                    <option value="참여자">참여자</option>';
            iHTML += '                    <option value="직접입력">직접입력</option>';
            iHTML += '                </select></div></div>';
            iHTML += '                &nbsp;';
            iHTML += '                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset"><input type="text" id="rollTxt'+ind+'" name="memberRoll" readonly></div>';
            iHTML += '            </div>';
            iHTML += '        </li>';
            iHTML += '    </ul>';
            iHTML += '</div>';

            $("#listviewArea").append(iHTML);
            <!--name으로 select태그를 찾아 변수에 Mapping-->
            var selID = "memberSel" + ind;
            var selbox = document.getElementById(selID);

            for(var i=0; i<parseEmployeeResult.length; i++) {
                //console.log(parseEmployeeResult[i].ID);
                //console.log(parseEmployeeResult[i].NAME);

                <!--멤버 id와 이름을 가져와 option에 value, text와 Mapping-->
                var op = new Option();

                op.value = parseEmployeeResult[i].ID;
                op.text = parseEmployeeResult[i].NAME + "(" + parseEmployeeResult[i].ID + ")";

                <!--selectBox에 option 추가-->
                selbox.options.add(op);
            }
            <!--직접입력 option 추가-->
            var op = new Option();
            op.value = "free";
            op.text = "직접입력";

            selbox.options.add(op);
            $("#putDt"+ind).datepicker({
                onSelect: function(selected) {
                    $("#withdrawDt"+ind).datepicker("option","minDate", selected)
                }
            });

            $("#withdrawDt"+ind).datepicker({
                onSelect: function(selected) {
                    $("#putDt"+ind).datepicker("option","maxDate", selected)
                }
            });
        }

        <!--memberSel select-->
        function memberSelect(index) {
            var selID = 'memberSel' + index;
            var inputID = 'memberName' + index;
            changeSelect(selID, inputID);
        }
        <!--rollSel select-->
        function rollSelect(index) {
            var selID = 'rollSel' + index;
            var inputID = 'rollTxt' + index;
            changeSelect(selID, inputID);
        }
        <!--gradeSel select-->
        function gradeSelect(index) {
            var selID = 'gradeSel' + index;
            changeSelect(selID);
        }
        <!--selectBox 선택 이벤트-->
        function changeSelect(selID, inputID) {
            console.log("selID>>>>>" + selID);
            <!--이벤트가 발생한 selBox 찾기-->
            var memSelect = document.getElementById(selID);

            <!--select element에서 선택된 option의 value가 저장된다.-->
            var selectValue = memSelect.options[memSelect.selectedIndex].value;
            <!--select element에서 선택된 option의 text가 저장된다.-->
            var selectText = memSelect.options[memSelect.selectedIndex].text;
            console.log("selectText>>>>" + selectText);

             $("#"+selID+"-button > span").text(selectText); // 선택된 값을 selectBox Span에 출력

            if(inputID != null) {
                console.log("inputID>>>>>" + inputID);
                <!--선택한 값을 띄울 input-->
                var viewInput = document.getElementById(inputID);
                 if(selectText == '직접입력') {
                    viewInput.readOnly = false;
                    viewInput.value = "";
                 } else {
                    viewInput.value = selectText;
                 }
            }
        }

        function modify() {
            var projectInfoJSON = new Object();

            // 프로젝트 정보 관련 Validation Check
            // 정규식 정리
            var patternNum = /^[0-9]+$/; // 숫자만 체크
            var patternSpecial = /^[`~!@#$%^&*|\\\'\";:\/?]+$/; // 특수문자만 체크

            // 프로젝트명
            var projectName = document.getElementById('projectName').value;
            if(projectName == "") { // 프로젝트명을 입력하지 않은 경우
                alert("프로젝트명을 입력해주세요");
                return false;
            }
            if(patternNum.test(projectName) || patternSpecial.test(projectName)) { // 프로젝트명이 숫자나 특수문자만으로 구성되어 있는 경우
                alert("프로젝트명을 확인해주세요");
                return false;
            }

            // 발주회사
            var projectComp = document.getElementById('projectComp').value;
            if(projectComp == "") { // 발주회사를 선택하지 않은 경우
                alert("발주회사를 선택해주세요");
                return false;
            }

            // 프로젝트 시작 종료일
            var projectStartDt = document.getElementById('projectStartDt').value;
            var projectEndDt = document.getElementById('projectEndDt').value;
            if(projectStartDt == "" || projectEndDt == "") {
                alert("프로젝트 시작/종료일을 입력해주세요");
                return false;
            }

            // 프로젝트 설명
            var projectExplain = document.getElementById('projectExplain').value;
            if(projectExplain == "") {
                alert("프로젝트 설명을 입력해주세요.");
                return false;
            }

            // 프로젝트 정보 make
            projectInfoJSON.name = projectName;
            projectInfoJSON.company = projectComp;
            projectInfoJSON.code = projectCode;
            projectInfoJSON.startDt = projectStartDt;
            projectInfoJSON.endDt = projectEndDt;
            projectInfoJSON.explain = projectExplain;

            // 멤버 투입정보 get
            var memberInsertArray = new Array(); // insert정보
            var memberUpdateArray = new Array(); // update정보
            var memberDeleteArray = new Array(); // delete정보
            var memberInfoName = document.getElementsByName('memberName');
            var memberInfoPutDt = document.getElementsByName('putDt');
            var memberInfoWithdrawDt = document.getElementsByName('withdrawDt');
            var memberInfoSkill = document.getElementsByName('skill');
            var memberInfoGrade = document.getElementsByName('gradeSel');
            var memberInfoRoll = document.getElementsByName('memberRoll');

            // 참여멤버 입력값이 있을때
            if(memberInfoName.length > 0) { // 참여멤버정보가 있으면 key가 되는 이름값으로 update/delete/insert여부 판단
                for(var index = 0; index < memberInfoName.length; index++) { // 이름값으로 update/insert
                    // 멤버 정보 관련 Validation Check
                    // 이름
                    if(memberInfoName[index].value == "") {
                        alert("인원 이름을 선택/입력해주세요."); // 필수값 check
                        return false;
                    }
                    // 이름 중복선택 check(이름과 프로젝트 코드가 테이블의 pk역할을 하므로 1개의 프로젝트에 참여인원의 이름이 중복되어서는 안된다.
                    for(var diffIndex = index + 1;diffIndex < memberInfoName.length; diffIndex++) { // 현재 인덱스로부터 마지막까지 반복문을 돌면서
                        if(memberInfoName[index].value == memberInfoName[diffIndex].value) { // 이름이 같으면 return false
                            alert("참여인원은 중복될 수 없습니다.");
                            return false;
                        }
                    }
                    // 참여기간
                    if(memberInfoPutDt[index].value == "" || memberInfoWithdrawDt[index].value == "") {
                        alert("참여기간을 입력해주세요."); // 필수값 check
                        return false;
                    }
                    // 프로젝트 기간과 참여기간의 비교
                    if(diffDate(projectStartDt, memberInfoPutDt[index].value, "start") == false) { // 프로젝트 시작일이 투입일보다 큰 경우
                        alert("투입일은 프로젝트 시작일보다 작을 수 없습니다.");
                        return false;
                    }
                    if(diffDate(projectStartDt, memberInfoPutDt[index].value, "end") == false) { // 프로젝트 종료일이 철수일보다 작은 경우
                        alert("철수일은 프로젝트 시작일보다 클 수 없습니다.");
                        return false;
                    }

                    // 사용기술
                    if(memberInfoSkill[index].value == "") {
                        alert("사용기술을 입력해주세요."); // 필수값 check
                        return false;
                    }

                    // 기술등급
                    if(memberInfoGrade[index].value == "") {
                        alert("기술등급을 선택해주세요."); // 필수값 check
                        return false;
                    }

                    // 참여형태
                    if(memberInfoRoll[index].value == "") {
                        alert("참여형태를 선택해주세요."); // 필수값 check
                        return false;
                    }
                    var memberInfoJSON = new Object();
                    // ID와 이름을 분리
                    var tempStr = memberInfoName[index].value; // 이름+id값을 변수에 저장
                    var cutStartIndex = tempStr.indexOf("("); // "("의 index값을 구한다.
                    if(cutStartIndex == -1) { // 괄호가 포함되어 있지 않은 경우(직접입력)
                        memberInfoJSON.id   = "free";
                        memberInfoJSON.name = tempStr;
                    } else { // select box에서 선택한경우
                        var cutEndIndex = tempStr.indexOf(")"); // ")"의 index값을 구한다.
                        memberInfoJSON.id   = tempStr.substring(cutStartIndex+1, cutEndIndex);
                        memberInfoJSON.name = tempStr.substr(0, cutStartIndex);
                    }
                    memberInfoJSON.putDt = memberInfoPutDt[index].value;
                    memberInfoJSON.withdrawDt = memberInfoWithdrawDt[index].value;
                    memberInfoJSON.skill = memberInfoSkill[index].value;
                    memberInfoJSON.grade = memberInfoGrade[index].value;
                    memberInfoJSON.roll = memberInfoRoll[index].value;
                    if(isUpdateOrInsert(memberInfoJSON.id, memberInfoJSON.name) == "update") {
                        memberUpdateArray.push(memberInfoJSON); // update Array에 push
                    } else {
                        memberInsertArray.push(memberInfoJSON); // insert Array에 push
                    }
                }

                if(memberUpdateArray.length > 0) { // update건수가 있으면
                    projectInfoJSON.updateList = memberUpdateArray;
                }
                    projectInfoJSON.updateIndex = memberUpdateArray.length;

                if(memberInsertArray.length > 0) { // insert건수가 있으면
                    projectInfoJSON.insertList = memberInsertArray;
                }
                    projectInfoJSON.insertIndex = memberInsertArray.length;

                // 이중for문을 통해 select데이터에서 삭제된 정보가 있는지 check한다.
                for(var selectIndex = 0; selectIndex < selectMemberProjectInfo.length; selectIndex++) {
                    var isDelete = true; // default값 true
                    var deleteID = selectMemberProjectInfo[selectIndex].id;
                    var deleteName = selectMemberProjectInfo[selectIndex].name;
                    for(listIndex = 0; listIndex < memberInfoName.length; listIndex++) {
                        var tempStr = memberInfoName[listIndex].value; // 이름+id값을 변수에 저장
                        var cutStartIndex = tempStr.indexOf("("); // "("의 index값을 구한다.
                        var listID = "";
                        var listName = "";
                        if(cutStartIndex == -1) { // 괄호가 포함되어 있지 않은 경우(직접입력)
                            listID   = "free";
                            listName = tempStr;
                        } else { // select box에서 선택한경우
                            var cutEndIndex = tempStr.indexOf(")"); // ")"의 index값을 구한다.
                            listID   = tempStr.substring(cutStartIndex+1, cutEndIndex);
                            listName = tempStr.substr(0, cutStartIndex);
                        }
                        if(deleteID == "free") { // 프리랜서 조회결과
                            if(deleteID == listID) { // 아이디가 있는 임직원은 비교할 필요가 없음. 같은 프리랜서만 비교실행
                                if(deleteName == listName) { // 이름이 중복 - 데이터 있음(update대상 - delete하면 안됨.)
                                    isDelete = false;
                                    break;
                                }
                            }
                        } else { // 프리랜서가 아닌 경우 단순히 아이디로만 비교하면 됨(아이디가 고유한 key이기 때문에)
                            if(deleteID == listID) { // 아이디가 일치하는 경우 update대상임
                                isDelete = false;
                                break;
                            }
                        }
                    }

                    if(isDelete) { // true에서 false로 바뀌지 않은 경우(데이터가 삭제된 경우) 삭제
                        var deleteInfo = new Object();
                        deleteInfo.id = deleteID;
                        deleteInfo.name = deleteName;
                        memberDeleteArray.push(deleteInfo); // 삭제데이터 추가
                    }
                }

                if(memberDeleteArray.length > 0) { // 삭제데이터가 있으면
                    projectInfoJSON.deleteList = memberDeleteArray;
                }
                projectInfoJSON.deleteIndex = memberDeleteArray.length;
            } else { // 참여멤버 정보가 없으므로 조회당시의 데이터를 모두 delete
                if(selectMemberProjectInfo.length > 0) { // 조회당시에 데이터가 있을때만 비교(없으면 delete건수 없음)
                    for(var index = 0; index < selectMemberProjectInfo.length; index++) {
                        var deleteID = selectMemberProjectInfo[index].id;
                        var deleteName = selectMemberProjectInfo[index].name;

                        var deleteInfo = new Object();
                        deleteInfo.id = deleteID;
                        deleteInfo.name = deleteName;
                        memberDeleteArray.push(deleteInfo);
                    }
                    projectInfoJSON.deleteList = memberDeleteArray;
                }
                projectInfoJSON.deleteIndex = memberDeleteArray.length;
            }

            console.log("projectInfoJSON>>>>>" + JSON.stringify(projectInfoJSON));
            console.log("memberInsertArray>>>>>" + JSON.stringify(memberInsertArray));
            console.log("memberUpdateArray>>>>>" + JSON.stringify(memberUpdateArray));
            console.log("memberDeleteArray>>>>>" + JSON.stringify(memberDeleteArray));

            navigate(projectInfoJSON, "projectModify.json", projectModifySuccess);
        }

        // 멤버id, 이름으로 update/insert 판단
        function isUpdateOrInsert(id, name) {
            var returnValue = "insert"; // 리턴값
            if(id == "free") {
                for(var i =0; i<selectMemberProjectInfo.length; i++) { // 조회당시 데이터가 있을때만(없으면 무조건 insert)
                    if(name == selectMemberProjectInfo[i].name) { // 조회당시의 이름목록에 포함된 경우(기존데이터 - update)
                        returnValue = "update";
                        break;
                    } else { // 조회당시의 이름목록에 포함되지 않은 경우(신규데이터 - insert)
                        returnValue = "insert";
                    }
                }
            } else {
                for(var i =0; i<selectMemberProjectInfo.length; i++) { // 조회당시 데이터가 있을때만(없으면 무조건 insert)
                    if(id == selectMemberProjectInfo[i].id) { // 조회당시의 이름목록에 포함된 경우(기존데이터 - update)
                        returnValue = "update";
                        break;
                    } else { // 조회당시의 이름목록에 포함되지 않은 경우(신규데이터 - insert)
                        returnValue = "insert";
                    }
                }
            }
            return returnValue;
        }

        function projectModifySuccess(result) {
            console.log("성공");
            alert("수정되었습니다.");
            movePage('projectList.html');
        }

        function diffDate(projectDate, memberDate, trigger) {
            var splitDate1 = projectDate.split('/');
            var splitDate2 = memberDate.split('/');
            var resultData = "";
            var da1 = new Date(splitDate1[0], splitDate1[1], splitDate1[2]);
            var da2 = new Date(splitDate2[0], splitDate2[1], splitDate2[2]);
            var dif = da2 - da1;
            var cDay = 24 * 60 * 60 * 1000;// 시 * 분 * 초 * 밀리세컨
            if(trigger == "start") {
                if(parseInt(dif/cDay) >= 0) {
                    resultData = true;
                } else {
                    resultData = false;
                }
            } else if(trigger == "end") {
                if(parseInt(dif/cDay) <= 0) {
                    resultData = true;
                } else {
                    resultData = false;
                }
            }
        }
    </script>
</head>

<body>
<section id="page1" data-role="page">
    <!-- header -->
    <header data-role="header">
        <h1>프로젝트 상세정보</h1>
        <a href="#menuPanel" class="ui-btn-right" data-icon="bars">menu</a>
    </header>

    <div data-role="panel" class="menuPanel"id="menuPanel" data-position="right"  data-display="overlay" data-theme="a">
        <img src="../css/images/calebslab_CI_1_upper-300x108.png" alt="CalebsLab">
        <ul id="menuPanelList"data-role="listview">
            <p>내정보</p>
            <li><a onclick= "movePage('employeeDetail.html')" >마이페이지</a></li>
            <p>프로젝트</p>
            <li><a onclick= "movePage('projectList.html')" >프로젝트</a></li>
            <li><a onclick= "movePage('planList.html')" >프로젝트일정 목록</a></li>
            <p>휴가</p>
            <li><a onclick= "movePage('employeeDetail.html')" >휴가신청</a></li>
            <li><a onclick= "movePage('holidayList.html')" >휴가신청내역</a></li>
            <li><a onclick= "movePage('calendar.html')" >휴가캘린더</a></li>
            <p>게시판</p>
            <li><a onclick= "movePage('qnaList.html')" >FAQ</a></li>
            <p class="admMenu">관리</p>
            <li class="admMenu"><a onclick= "movePage('employeeDetail.html')" >사원등록</a></li>
            <li class="admMenu"><a onclick= "movePage('employeeInfo.html')" >사원목록</a></li>
            <li class="admMenu"><a onclick= "movePage('holidayCondition.html')">휴가현황</a></li>
        </ul>
    </div>
    <!-- container -->
    <div data-role="content" class="regist-project">
        <!--프로젝트 info division-->
        <div class="pjt-info">
            <!--제목-->
            <div class="title_area">
                <h3>• 프로젝트 기본정보 </h3>
            </div>

            <!--프로젝트정보-->
            <div class="gird-pt project-form">
                <form>
                    <div class="ui-field-contain">
                        <label for="projectName">프로젝트명</label>
                        <input type="text" id="projectName">
                    </div>
                    <div class="ui-field-contain">
                        <label for="projectComp">발주회사</label>
                        <select id="projectComp" style="z-index: 0;"></select>
                    </div>
                    <div class="ui-field-contain">
                        <label for="datepicker">프로젝트 기간</label>
                        <div id="datepicker" class="picker">
                            <input type="text" id="projectStartDt" class="datepicker" readonly> ~
                            <input type="text" id="projectEndDt" class="datepicker" readonly>
                        </div>
                    </div>
                    <div class="ui-field-contain">
                        <label for="projectExplain">설명</label>
                        <textarea cols="40" rows="8" id="projectExplain"></textarea>
                    </div>
                </form>
            </div>
        </div>

        <!--참여인원 info division-->
        <div class="member_info">
            <!--제목, 삭제, 추가 버튼-->
            <div class="title-area">
                <div class="gird-pt select-area">
                    <div class="grid-cd-1">
                        <h3>• 참여인원 </h3>
                    </div>
                    <div class="grid-cd-2" id="btnMemberEdit">
                        <a href="#" class="ui-shadow ui-btn ui-corner-all ui-btn-inline ui-btn-b" onclick="btnDel()">삭제</a>
                        <a href="#" class="ui-shadow ui-btn ui-corner-all ui-btn-inline ui-btn-b" onclick="btnAdd()">추가</a>
                    </div>
                </div>
            </div>
            <!--인원등록 ListView-->
            <div class="listview-area" id="listviewArea"></div>
        </div>

        <!--버튼 Area-->
        <div class="btn_area">
            <div class="grid-pt" id="btnEdit">
                <div class="grid-cd-1"><a href="#" class="ui-btn ui-shadow ui-corner-all" onclick="movePage('projectList.html')">취소</a></div>
                <div class="grid-cd-2"><a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-b" onclick="modify()">수정</a></div>
            </div>
            <div class="gird-pt" id="btnReadonly">
                <button class="ui-btn ui-corner-all ui-btn-b" id="btnBack" onclick="movePage('projectList.html')">목록</button>
            </div>
        </div>
    </div>
    <!-- //container -->
    <!-- footer -->
    <div class="footer" data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a onclick="movePage('main.html')" data-icon="home">홈</a></li>
                <li><a onclick="movePage('projectList.html')" data-icon="shop">프로젝트</a></li>
                <li><a href="#" data-icon="calendar">휴가신청</a></li>
                <li><a href="#" data-icon="power" onclick="javascript:callLogout()";>로그아웃</a></li>
            </ul>
        </div>
    </div>
</section>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css">
    <script src="../js/common.js"></script>
    <script src="../js/login.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script language="JavaScript">

        function findId(){

            var email = $('#email').val();
            var birth = $('#birth').val();
            var id = $('#id').val();

            if(email == null || email ==''){
                alert("이메일 입력해주세요");
                return false;
            }

            if(id == null || id ==''){
                alert("아이디를 입력해주세요");
                return false;
            }

            if(birth == null || birth ==''){
                alert("생년월일을 입력해주세요 (ex)19920818)");
                return false;
            }

            var param = {"email" : email, "id" : id , "birth" : birth};

            navigate(param,"findPwd.json",successFindId);

        }

        function successFindId(result){

            if(result.pwd != null){

               toastLong("메일 전송중");

               Email.send({
                SecureToken : "1fcf4579-8e46-4fcd-a95c-94ec7fa5cae7",
                To : result.email,
                From : "contact@calebslab.com",
                Subject : "[갈렙스랩 비밀번호 찾기 결과.]",
                Body : "귀하의 비밀번호는 ["+result.pwd+"] 입니다"
            }).then(
                function (message) {
                    if(message == "OK"){
                        movePage("resultPw.html",result.pwd);
                    }else{
                        alert("메일전송 실패");
                    }
              }
            );


            }else{
                alert("입력된 정보가 일치하지 않습니다");
            }

            /*
                Host : "smtp.gmail.com",
                Username : "rlxod1234@gmail.com",
                Password : "sig9538*",
            */


            //movePage("resultPw.html",result.result);
        }
    </script>

    <style>
        #findIdDiv {background-color:white; padding:10% 10% 0 10%; height: 100%;}
    </style>
</head>

<body bgcolor="#E6E6FA">
<header data-role="header">
    <h1>비밀번호 찾기</h1>
</header>
<div id="findIdDiv" class="container">

    <div>
        <p>비밀번호 찾기를 위해 생년월일, 아이디, 가입시 등록한 이메일주소를 정확히 입력하여주시기 바랍니다.</p>
        <label for="email">이메일</label>
        <input type="text" name="email" id="email" value="">
        <label for="id">아이디</label>
        <input type="text" name="id" id="id" value="">
        <label for="birth">생년월일</label>
        <input type="text" name="birth" id="birth" value="">

    </div>
    <div id="loginBtn" onclick="event.cancelBubble = true;">
        <button class="ui-btn ui-corner-all" onclick="movePage('login.html')"; style="width: 49%; display: inline;">취소</button>
        <button class="ui-btn ui-corner-all" onclick="findId();" style="width: 49%; display: inline;">확인</button>
    </div>

</div>

</body>
</html>
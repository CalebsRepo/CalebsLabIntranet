<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css">
    <!--DatePicker--><link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="../css/project_plan.css">
    <link rel="stylesheet" href="../css/menu.css">
    <script src="../js/login.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/datepicker.js"></script>
    <script src="../js/postCodeAPI.js"></script><!--다음 지도 api-->
    <script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script> <!--다음 지도 api-->
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <!--DatePicker--><script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <!--DatePicker--><script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <title></title>
    <script>

        $(document).ready(function(){
            $("#jusoAPI").hide();

            window.addEventListener('message', function(e) {
            //  console.log("받은 데이테 : " + e.data);
                $("#zip_code").val(e.data[0]);
                $("#address1").val(e.data[1]);

                $("#jusoAPI").hide();
                $("#address2").focus();
            })

        });

        <!--상세페이지 데이터 셋팅 START-->
        $(function(){
             var ajaxResult=JSON.parse(getStorageItem());
                $('#pic1').attr('src',"http://calebslab1.cdn3.cafe24.com/imployeeInfo/profile/"+ajaxResult[0].id+".png"); <!--1.프로필사진-->
                $('#pic2').attr('src',"http://calebslab1.cdn3.cafe24.com/imployeeInfo/sign/"+ajaxResult[0].id+"_sign.png"); <!--2.사인사진-->
                $('#employeeName').val(ajaxResult[0].name); <!--3.이름-->
                $('#birth_ymd').val(ajaxResult[0].birth_ymd); <!--4.생년월일-->

                $("#selGrade option:contains('"+ajaxResult[0].grade+"')").prop('selected', 'selected'); <!--5.직급-->
                $("#selGrade").selectmenu("refresh", true);

                $('#join_ymd').val(ajaxResult[0].join_ymd); <!--6.입사일자-->
                $('#employeeId').val(ajaxResult[0].id); <!--7.아이디-->


                $('#employeeEmail').val(ajaxResult[0].email); <!--8.이메일-->
                $('#hp_num').val(ajaxResult[0].hp_num); <!--9.연락처-->
                $('#contact_num').val(ajaxResult[0].contact_num); <!--10.비상연락처-->

                $('#sample2_postcode').val(ajaxResult[0].zip_code); <!--11.우편번호-->
                $('#sample2_address').val(ajaxResult[0].address1); <!--12.주소-->
                $('#sample2_detailAddress').val(ajaxResult[0].address2); <!--13.상세주소-->

                $("#adm_flag option:contains('"+ajaxResult[0].adm_flag+"')").prop('selected', 'selected'); <!--14.권한-->
                $("#adm_flag").selectmenu("refresh", true);

                pwdDecrypt(ajaxResult[0].pwd);
        });
        <!--상세페이지 데이터 셋팅 START-->

        <!--복호화 START-->
            <!--1. 복호화-->
            function pwdDecrypt(pwd){
                var params = {
                        pwd: pwd
                };
                navigate(params, "pwdDecrypt.json", pwdSuccess);
            }
            <!--2. 비밀번호 셋팅-->
            function pwdSuccess(result){
                var data=JSON.parse(JSON.stringify(result));
                $('#employeePwd').val(data.pwd);  <!--15.비밀번호-->
                $('#employeePwd2').val(data.pwd); <!--16.비밀번호 확인-->
            }
        <!--END-->


        <!--사진 첨부파일 미리보기, 사진실제경로 , 서버에 사진 전송 START-->
       var imgPathArray="";
       var newTr = ',';
       var count = 1;
       $(function(){
            $('#camera').change(function(e){
                 $('#pic1').attr('src', URL.createObjectURL(e.target.files[0]));
                 window.android.imgPath(count,"profile");
                 count+=1;
            });
            $('#camera2').change(function(e){
                 $('#pic2').attr('src', URL.createObjectURL(e.target.files[0]));
                 window.android.imgPath(count,"sign");
                 count+=1;
            });
        })

        function employeeUpdate(){
            imgPathArray="";  <!--초기화-->
            count=1;
            window.android.imgFtpSend();
        }
        <!--END-->


        <!--커밋하기전 체크-->
        function commitBefore(num){
           <!--1. 정규식체크 -->
           var reg_name= /^[가-힣]{1,4}$/;                                                                    <!--이름: 4자리이름까지, 자음불가-->
           var reg_id=/^[a-z0-9_]{8,12}$/;                                                                    <!--아이디: 8~12자 영문소문자, 숫자, 언더라인(_) 사용가능-->
           var reg_pwd=/^(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]|.*[0-9]).{8,12}$/;                                   <!--비밀번호: 8~12자 영문대소문자, 숫자, 특수문자 혼합 사용-->
           var reg_email=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/; <!--이메일-->
           var reg_phone=/^[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}$/;                                                   <!--연락처, 비상연락처:형식 (010-1111-2222)-->

           <!--2. employeeUpdate() 호출해서 이미지 서버 전송-->
            if(count!=1){
                employeeUpdate();
            }
            commit(num);
        }

       function isSame(){
            var pw=document.getElementById('employeePwd').value;
            var confirmPW = document.getElementById('employeePwd2').value;

            if(pw.length<8 || pw.length>16){
                document.getElementById('same').innerHTML='비밀번호는 8자리에서 16자리만 가능합니다';
                document.getElementById('same').style.color='red';
                document.getElementById('employeePwd').value=document.getElementById('employeePwd2').value='';
                document.getElementById('same').innerHTML='';
            }
            if(document.getElementById('employeePwd').value!='' && document.getElementById('employeePwd2').value!=''){
                if(document.getElementById('employeePwd').value==document.getElementById('employeePwd2').value){
                    document.getElementById('same').innerHTML='비밀번호가 일치합니다.';
                    document.getElementById('same').style.color='blue';
                }else{
                    document.getElementById('same').innerHTML='비밀번호가 일치하지 않습니다.';
                    document.getElementById('same').style.color='red';
                }
            }
        }

       // 사원상세, 마이페이지: update, 사원등록 : insert
       function commit(num) {
            <!--3. 비밀번호 셋팅-->
            <!--4. 실제 값 셋팅해서 DB 전송-->
            var form_data = {
                                name: $('#employeeName').val(),                  <!--3.이름-->
                                birth_ymd: $("#birth_ymd").datepicker("getDate"),<!--4.생년월일-->
                                grade: $("#selGrade option:selected").val(),     <!--5.직급-->
                                join_ymd: $("#join_ymd").datepicker("getDate"),  <!--6.입사일자-->
                                email: $('#employeeEmail').val(),                <!--8.이메일-->
                                hp_num: $('#hp_num').val(),                      <!--9.연락처-->
                                contact_num: $('#contact_num').val(),            <!--10.비상연락처-->
                                zip_code: $('#sample2_postcode').val(),          <!--11.우편번호-->
                                address1: $('#sample2_address').val(),           <!--12.주소-->
                                address2: $('#sample2_detailAddress').val(),     <!--13.상세주소-->
                                adm_flag: $("#adm_flag option:selected").val(),  <!--14.권한-->
                                pwd: $('#employeePwd').val()                     <!--15. 비밀번호-->
                             }

          switch (num) {
            case 1: // 등록
                navigate(form_data, "employeeInsert.json", successInsert);
               break;

            case 2: // 수정
                navigate(form_data, "employeeUpdate.json", successUpdate);
               break;
         }// end of switch(num)--------------------------

       }// end of commit(num)-------------------------------------------


       function successUpdate(result){
            var data=JSON.parse(JSON.stringify(result));
            if(data=="0"){
                alert("실패");
            }else{
                alert("성공");
                movePage('employeeInfo.html');
            }
       }

       function daumApiShow() {
            $("#jusoAPI").show();
       }


    </script>

</head>

<body onload="getStorageItem()">
<section id="page1" data-role="page">
    <div data-role="content" class="plan-detail">
        <!--제목-->
        <div  class="title-area">
            <div class="gird-pt">
                <h3>• 사원 상세정보 </h3>
            </div>
        </div>
        <style>
            div#select-2-button { padding: 7.5px 5px; background:#ffffff;}
            div#select-2-button span { text-align: left; font-weight: 600;}

        </style>

        <!--사원 상세정보 페이지-->
        <div class="gird-pt detail-form">
            <form>
                <img id="pic1" style="width:47.5%; high:100%; float:left; margin-right:5%;"/>
                <img id="pic2" style="width:47.5%; high:100%; float:left;"/>
                <br>
                <div class="ui-field-contain">
                    <label for="camera">프로필첨부</label>
                    <input type="file" id="camera" name="camera"/>
                </div>
                <div class="ui-field-contain">
                    <label for="camera">사인첨부</label>
                    <input type="file" id="camera2" name="camera2" capture="camera" accept="image/*" />
                </div>

                <div class="ui-field-contain">
                    <label for="employeeName">이    름</label>
                    <input type="text" name="employeeName" id="employeeName" placeholder="이름을 입력하세요" value="" >
                </div>
                <div class="ui-field-contain">
                    <label for="birth_ymd">생년월일</label>
                    <input type="text" name="birth_ymd" id="birth_ymd"placeholder="생년월일을 선택해주세요" value="" readonly>
                    <script>
                        $("#birth_ymd").datepicker();
                    </script>
                </div>
                <div class="ui-field-contain">
                    <label for="selGrade">직    급</label>
                    <select name="selGrade" id="selGrade" class="ui-corner-all">
                        <option value="사원">사원</option>
                        <option value="대리">대리</option>
                        <option value="과장">과장</option>
                        <option value="차장">차장</option>
                        <option value="부장">부장</option>
                        <option value="이사">이사</option>
                        <option value="상무">상무</option>
                        <option value="대표">대표</option>
                    </select>
                </div>
                <div class="ui-field-contain">
                    <label for="join_ymd">입사일자</label>
                    <input type="text" name="join_ymd" id="join_ymd" placeholder="입사일자를 선택해주세요" value="" readonly>
                    <script>
                        $("#join_ymd").datepicker();
                    </script>
                </div>
                <div class="ui-field-contain">
                    <label for="employeeId">아이디</label>
                    <input type="text" name="employeeId" id="employeeId" placeholder="아이디를 입력하세요" value="" readonly>
                </div>
                <div class="ui-field-contain">
                    <label for="employeePwd">비밀번호</label>
                    <input type="password" name="employeePwd" id="employeePwd" placeholder="비밀번호를 입력하세요" onchange='isSame()'>
                </div>
                <div class="ui-field-contain">
                    <label for="employeePwd2">비밀번호 확인</label>
                    <input type="password" name="employeePwd2" id="employeePwd2" value="" onchange='isSame()' >
                </div>
                <!--&nbsp; <span id="same"></span>-->
                <div class="ui-field-contain">
                    <label for="employeeEmail">이메일</label>
                    <input type="text" name="employeeEmail" id="employeeEmail" placeholder="이메일을 입력하세요" value="" >
                </div>
                <div class="ui-field-contain">
                    <label for="hp_num">연락처</label>
                    <input type="text" name="hp_num" id="hp_num"  value="" >
                </div>
                <div class="ui-field-contain">
                    <label for="contact_num">비상연락처</label>
                    <input type="text" name="contact_num" id="contact_num"value="" >
                </div>
                <!--<div class="ui-field-contain">-->
                <div class="btn-area-3">
                    <div class="grid-pt">
                        <div class="grid-cd-1"><label for="sample2_postcode">우편번호</label></div>
                        <div class="grid-cd-2"><input type="text" name="sample2_postcode" id="zip_code"></div>
                        <div class="grid-cd-3"><a onclick="daumApiShow()">우편번호찾기</a></div>
                    </div>
                </div>
                <div class="ui-field-contain">
                    <label for="sample2_postcode">주 소</label>
                    <input type="text" id="address1" placeholder="주소">
                </div>
                <div class="ui-field-contain">
                    <label for="sample2_detailAddress">상세주소</label>
                    <input type="text" name="sample2_detailAddress"id="sample2_detailAddress" placeholder="나머지 주소를 입력해주세요">
                </div>
                <iframe src="http://calebslab1.cafe24.com/daumApi.do" width="100%;"; height="400px"; frameborder="0" id="jusoAPI">
                </iframe>

                <div class="ui-field-contain">
                    <label for="adm_flag">권한</label>
                    <select name="adm_flag" id="adm_flag" class="ui-corner-all">
                        <option value="G">G</option>
                        <option value="A">A</option>
                        <option value="U">U</option>
                    </select>
                </div>

            </form>
        </div>
        <style>

        </style>
        <div class="btn-area-1">
            <div class="grid-pt">
                <div class="grid-cd-1"><a href="#" class="ui-btn ui-shadow ui-corner-all">취소</a></div>
                <div class="grid-cd-2"><a href="#" class="ui-btn ui-shadow ui-corner-all ui-btn-b" onclick="javascript:commitBefore(); return false;">수정</a></div>
            </div>
        </div>

    </div>



</section>
</body>
</html>